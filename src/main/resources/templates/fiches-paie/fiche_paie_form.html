<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Fiche de Paie</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="home-page">
<!-- Sidebar -->
<div th:insert="fragments/sidebar :: sidebar"></div>

<!-- Main content -->
<div class="content">
    <div class="form-container">
        <h1 th:text="${fichePaie.id != null ? '‚úèÔ∏è Modifier une fiche de paie' : '‚ûï Ajouter une fiche de paie'}"></h1>

        <form id="fichePaieForm" th:action="@{/fiches-paie/save}" th:object="${fichePaie}" method="post" novalidate>
            <input type="hidden" th:field="*{id}">

            <div th:if="${#fields.hasErrors('global')}" class="alert alert-error">
                <p th:each="err : ${#fields.errors('global')}" th:text="${err}"></p>
            </div>

            <div class="form-group">
                <label for="idEmployer">Employ√© <span class="required">*</span></label>
                <select id="idEmployer" name="idEmployer" th:field="*{idEmployer}"
                        th:classappend="${#fields.hasErrors('idEmployer')} ? 'error'" required>
                    <option value="">-- S√©lectionner un employ√© --</option>
                    <option th:each="emp : ${employees}"
                            th:value="${emp.id}"
                            th:text="${emp.prenom + ' ' + emp.nom + ' - ' + emp.matricule}">
                    </option>
                </select>
                <span class="error-message" th:if="${#fields.hasErrors('idEmployer')}"
                      th:errors="*{idEmployer}"></span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="mois">Mois <span class="required">*</span></label>
                    <select id="mois" name="mois" th:field="*{mois}"
                            th:classappend="${#fields.hasErrors('mois')} ? 'error'" required>
                        <option value="">-- S√©lectionner un mois --</option>
                        <option value="1">Janvier</option>
                        <option value="2">F√©vrier</option>
                        <option value="3">Mars</option>
                        <option value="4">Avril</option>
                        <option value="5">Mai</option>
                        <option value="6">Juin</option>
                        <option value="7">Juillet</option>
                        <option value="8">Ao√ªt</option>
                        <option value="9">Septembre</option>
                        <option value="10">Octobre</option>
                        <option value="11">Novembre</option>
                        <option value="12">D√©cembre</option>
                    </select>
                    <span class="error-message" th:if="${#fields.hasErrors('mois')}"
                          th:errors="*{mois}"></span>
                </div>

                <div class="form-group">
                    <label for="annee">Ann√©e <span class="required">*</span></label>
                    <input type="number" id="annee" name="annee" th:field="*{annee}"
                           th:classappend="${#fields.hasErrors('annee')} ? 'error'"
                           required
                           min="2020"
                           th:max="${#dates.year(#dates.createNow())}"
                           placeholder="Ex: 2025">
                    <span class="error-message" th:if="${#fields.hasErrors('annee')}"
                          th:errors="*{annee}"></span>
                    <small class="field-hint">Impossible de cr√©er une fiche pour un mois futur</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="salaireBase">Salaire de base (‚Ç¨) <span class="required">*</span></label>
                    <input type="number" id="salaireBase" name="salaireBase" th:field="*{salaireBase}"
                           th:classappend="${#fields.hasErrors('salaireBase')} ? 'error'"
                           required
                           step="0.01"
                           min="1000"
                           max="1000000"
                           placeholder="Ex: 2500.00">
                    <span class="error-message" th:if="${#fields.hasErrors('salaireBase')}"
                          th:errors="*{salaireBase}"></span>
                    <small class="field-hint">Minimum: 1000‚Ç¨</small>
                </div>

                <div class="form-group">
                    <label for="primes">Primes (‚Ç¨)</label>
                    <input type="number" id="primes" name="primes" th:field="*{primes}"
                           th:classappend="${#fields.hasErrors('primes')} ? 'error'"
                           step="0.01"
                           min="0"
                           max="100000"
                           placeholder="Ex: 150.00">
                    <span class="error-message" th:if="${#fields.hasErrors('primes')}"
                          th:errors="*{primes}"></span>
                    <small class="field-hint">Optionnel, doit √™tre positif</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="deductions">D√©ductions (‚Ç¨)</label>
                    <input type="number" id="deductions" name="deductions" th:field="*{deductions}"
                           th:classappend="${#fields.hasErrors('deductions')} ? 'error'"
                           step="0.01"
                           min="0"
                           max="100000"
                           placeholder="Ex: 50.00">
                    <span class="error-message" th:if="${#fields.hasErrors('deductions')}"
                          th:errors="*{deductions}"></span>
                    <small class="field-hint">Ne peut pas d√©passer le salaire + primes</small>
                </div>

                <div class="form-group">
                    <label for="dateGeneration">Date de g√©n√©ration <span class="required">*</span></label>
                    <input type="date" id="dateGeneration" name="dateGeneration" th:field="*{dateGeneration}"
                           th:classappend="${#fields.hasErrors('dateGeneration')} ? 'error'"
                           required
                           min="2020-01-01"
                           th:max="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                    <span class="error-message" th:if="${#fields.hasErrors('dateGeneration')}"
                          th:errors="*{dateGeneration}"></span>
                    <small class="field-hint">Ne peut pas √™tre dans le futur</small>
                </div>
            </div>

            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Information :</strong> Le net √† payer sera calcul√© automatiquement :
                <em>Salaire de base + Primes - D√©ductions</em>
                <br><br>
                <strong>üí° R√®gles de validation :</strong>
                <ul>
                    <li>L'employ√© doit √™tre s√©lectionn√©</li>
                    <li>Le mois et l'ann√©e sont obligatoires</li>
                    <li>Impossible de cr√©er une fiche pour un mois futur</li>
                    <li>L'ann√©e doit √™tre entre 2020 et l'ann√©e courante</li>
                    <li>Le salaire de base doit √™tre entre 1000‚Ç¨ et 1 000 000‚Ç¨</li>
                    <li>Les primes doivent √™tre positives (max 100 000‚Ç¨)</li>
                    <li>Les d√©ductions doivent √™tre positives et ne peuvent pas d√©passer le salaire total</li>
                    <li>La date de g√©n√©ration ne peut pas √™tre dans le futur ni avant le mois de la fiche</li>
                    <li>La date de g√©n√©ration ne doit pas √™tre trop ancienne (moins de 5 ans)</li>
                </ul>
            </div>

            <div class="btn-container">
                <a th:href="@{/fiches-paie}" class="btn btn-secondary">‚ùå Annuler</a>
                <button type="submit" class="btn btn-primary">üíæ Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/js/form-validation.js}"></script>
</body>
</html>